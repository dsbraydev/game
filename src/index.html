<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <script src="./Libs/pep.min.js"></script>
    <script src="./Libs/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js"></script>
  </head>

  <body>
    <div id="gameContainer">
      <canvas id="canvas" touch-action="none"></canvas>
      <div id="ui">
        <div id="gameScreen" class="screen">
          <div id="intro">
            <h1 id="animated-heading">Card Treasure Hunt</h1>
            <div class="card-group">
              <img class="card-flip" src="./Textures/Card/backCard.webp" />
              <img class="card-flip" src="./Textures/Card/backCard.webp" />
              <img class="card-flip" src="./Textures/Card/backCard.webp" />
              <img class="card-flip" src="./Textures/Card/backCard.webp" />
            </div>
            <div class="fade-up">
              <p>Select a card to stand a change to WIN BIG!!</p>
              <button id="startButton">Start Game</button>
            </div>
          </div>

          <div id="gameplay" style="display: none">
            <h2>Pick a card!</h2>
            <div class="streak">
              Streak:
              <p id="streakCount" class="streak-text">0</p>
            </div>
            <p id="resultText"></p>
            <div id="cardContainer">
              <div class="card" data-index="0">
                <div class="card-inner">
                  <div class="card-front">
                    <img src="./Textures/Card/backCard.webp" />
                  </div>
                  <div class="card-back">
                    <img
                      src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
                    />
                  </div>
                </div>
              </div>
              <div class="card" data-index="1">
                <div class="card-inner">
                  <div class="card-front">
                    <img src="./Textures/Card/backCard.webp" />
                  </div>
                  <div class="card-back">
                    <img
                      src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      const { animate, stagger } = Motion;

      const textEl = document.getElementById("animated-heading");
      const text = textEl.textContent;

      // Split text into span-wrapped letters
      textEl.innerHTML = text
        .split("")
        .map((char) => `<span>${char === " " ? "&nbsp;" : char}</span>`)
        .join("");

      // Animate each letter from bottom up with fade in
      animate(
        "#animated-heading span",
        {
          opacity: [0, 1],
          y: [40, 0],
        },
        {
          duration: 0.5,
          delay: stagger(0.06),
          easing: "ease-out",
        }
      );
      animate(
        ".fade-up",
        {
          opacity: [0, 1],
          y: [20, 0],
        },
        {
          duration: 0.8,
          delay: stagger(0.3), // delay between each element
          easing: "ease-out",
        }
      );
      const cards = document.querySelectorAll(".card-flip");
      const images = [
        "./Textures/Card/backCard.webp",
        "./Textures/Card/treasureCard.webp",
        "./Textures/Card/bombCard.webp",
      ];

      function flipRandomly(card) {
        setInterval(() => {
          card.classList.add("flipping");
          setTimeout(() => {
            const randomImage =
              images[Math.floor(Math.random() * images.length)];
            card.src = randomImage;
            card.classList.remove("flipping");
          }, 200); // match half the flip time
        }, Math.random() * 2000 + 1000);
      }

      cards.forEach((card) => {
        flipRandomly(card);
      });
    </script>
  </body>
</html>
